apiVersion: apps/v1
kind: Deployment
metadata:
  name: hammerdb
  labels:
    app: hammerdb
spec:
  replicas: 1
  selector:
    matchLabels:
      app: hammerdb
  template:
    metadata:
      labels:
        app: hammerdb
    spec:
      nodeSelector:
        own_ip: 100.64.176.37
      containers:
      - name: hammerdb
        image: 100.64.176.12:80/wca/hammerdb:013646a7510e88a8a40f1e2cee4b631024ab6c97
        command: [ "source" ]
        args:  ["workload.yaml" ]
        securityContext:
          runAsUser: 0
      - name: mysql-tpm-gauge
        image: 100.64.176.12:80/wca/mysql_tpm_gauge:013646a7510e88a8a40f1e2cee4b631024ab6c97
        command: [ "/bin/sh" ]
        args:  ["-c", "$(COMMAND)" ]
        securityContext:
          runAsUser: 0
        env:
        - name: COMMAND
          valueFrom:
            configMapKeyRef:
              name: mysql-tpm-gauge-command
              key: COMMAND
