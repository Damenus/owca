resources:
  - controller.yaml
  - group.yaml

configMapGenerator:
  - name: specjbb
    # worker_size # used as instances of grp tasks
    # gc_size     # -XX:ParallelGCThreads - equals to number of cores for backend
    # mr_size     # default: max(Runtime.getRuntime().availableProcessors(), specjbb.group.count * (specjbb.txi.pergroup.count +1))
    #             # according: https://www.spec.org/jbb2015/docs/runrules.pdf
    # maxheap     # 1500 -> ram megabytes per core
    # maxram      # by Ismo to set -XX:MaxRAM=$maxram
    literals:
      # cores=`cat /proc/cpuinfo | grep processor | wc -l` or `nproc`
      - cores=56
      - id_env=
      # zones=`numactl -H | grep cpus | wc -l`
      - zones=2  # num of numa nodes
      - report_level=0

  - name: specjbb-java
    literals:
      # >> xmx == max allocation pool memory <<
      # >> xms == initial allocation pool memory <<
      # >> xmn == the size of the heap for the young generation <<
      # https://stackoverflow.com/questions/14763079/what-are-the-xms-and-xmx-parameters-when-starting-jvm
      # https://stackoverflow.com/questions/23880891/what-does-xmn-jvm-option-stands-for
      #XX:ParallelGCThreads calulated for backend
      - controller.ParallelGCThreads=2
      - txi.ParallelGCThreads=2
      # for the controller
      - contmeg="2g"
      - contnew="1536m"
      # for the injector
      - tximeg_numeric_gb=2
      - tximeg="2g"
      - txinew="1536m"
      # for the backend
      - backendimeg='18000M'
      - backendinew='16920M'
      - gc_size='12'
      - worker_size='12'
      # controler deafoult or from parametr
      # txi worker_size=$((($cores/$group_count)*2));
      # controler -Dspecjbb.forkjoin.worker
      # txi -Dspecjbb.forkjoin.worker


  - name: specjbb-config
    literals:
      # 'specjbb.group.count' set by number replicas groups and controllers
      - specjbb.group.count=1
      - specjbb.txi.pergroup.count=1
      - specjbb.controller.rtcurve.warmup.step=0.5
      - specjbb.controller.rtcurve.step=1
      - specjbb.controller.type=PRESET
      - controller.specjbb.forkjoin.workers=2
      - txi.specjbb.forkjoin.workers=2
      # specjbb.forkjoin.workers for backend is calculated
      # controller.specjbb.forkjoin.workers for txi no setting
      - specjbb.controller.validation.skip=true
      - specjbb.controller.preset.ir=1000
      - specjbb.controller.rampup.steps=1

vars:
  - name: GROUP_POD_NAME
    objref:
      kind: StatefulSet
      name: specjbb-group
      apiVersion: apps/v1
    fieldref:
      fieldpath: metadata.name
  - name: CONTROLLER_POD_NAME
    objref:
      kind: StatefulSet
      name: specjbb-controller
      apiVersion: apps/v1
    fieldref:
      fieldpath: metadata.name
  - name: SERVICE_NAME
    objref:
      kind: StatefulSet
      name: specjbb-controller
      apiVersion: apps/v1
    fieldref:
      fieldpath: metadata.name
